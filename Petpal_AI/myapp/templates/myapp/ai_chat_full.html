{% extends 'myapp/navbar.html' %}
{% block content %}
<div class="max-w-xl mx-auto mt-10">
  <h2 class="text-2xl font-bold mb-4">AI Chatbot (Gemini RAG)</h2>
  <div id="chat-window" class="bg-gray-100 rounded-lg p-4 h-96 overflow-y-auto mb-4"></div>
  <form id="chat-form">
    <input type="text" name="message" id="message" class="w-full px-4 py-2 rounded mb-2" placeholder="พิมพ์ข้อความ..." required>
    <button type="submit" class="bg-orange-500 text-white px-4 py-2 rounded">ส่งข้อความ</button>
  </form>
</div>
<script>
document.getElementById('chat-form').onsubmit = async function(e) {
  e.preventDefault();
  const msg = document.getElementById('message').value;
  const chatWindow = document.getElementById('chat-window');
  chatWindow.innerHTML += `<div class="mb-2 text-right"><span class="bg-orange-200 px-3 py-1 rounded">${msg}</span></div>`;
  const res = await fetch("{% url 'chat_api' %}", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({message: msg})
  });
  const data = await res.json();
  chatWindow.innerHTML += `<div class="mb-2 text-left"><span class="bg-gray-200 px-3 py-1 rounded">${data.response}</span></div>`;
  document.getElementById('message').value = "";
  chatWindow.scrollTop = chatWindow.scrollHeight;
};
</script>
{% endblock %}